:root {
    --bg:#0b0f14; --panel:#121923; --text:#e8eef6; --muted:#9fb3c8; --accent:#4da3ff; --accent2:#63e6be; --danger:#ff6b6b;
    --circle:#6aa3ff; --square:#7ce0bc; --triangle:#ffad66;
}
* { box-sizing:border-box }
body { margin:0; background:var(--bg); color:var(--text);
    font: 15px/1.45 system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji" }
header { padding:16px 20px; border-bottom:1px solid #1e2a3a; background:linear-gradient(180deg, #0f1622, #0b0f14) }
header h1 { margin:0; font-size:18px }
main { display:grid; grid-template-columns: 360px 1fr; gap:14px; padding:14px }
#controls { background:var(--panel); border:1px solid #1e2a3a; border-radius:14px; padding:14px; position:sticky; top:14px }
fieldset { border:0; margin:0 0 10px 0; padding:0 }
legend { font-weight:600; margin-bottom:8px }
label { display:grid; grid-template-columns: 1fr auto; align-items:center; gap:8px; margin:8px 0 }
input[type="number"], input[type="text"] { width:140px; padding:6px 8px; border-radius:10px; border:1px solid #243043; background:#0f1622; color:var(--text) }
input[type="range"], select { width:100% }
select { padding:6px 8px; border-radius:10px; border:1px solid #243043; background:#0f1622; color:var(--text) }
.row { display:flex; gap:8px; flex-wrap:wrap }
button { cursor:pointer; background:#182234; color:var(--text); border:1px solid #243043; padding:10px 12px; border-radius:12px; font-weight:600; height:40px }
button.primary { background:var(--accent); color:#001a32; border-color:#2f89ea }
button.ghost { background:transparent }
button.warn { background:var(--danger); color:#2b0b0b; border-color:#d95b5b }
.legend { display:flex; gap:10px; align-items:center; font-size:14px; color:var(--muted); margin-top:6px; flex-wrap:wrap }
.chip { width:10px; height:10px; border-radius:3px; display:inline-block; border:1px solid #0007 }
canvas#canvas { width:100%; height:calc(100vh - 110px); background: radial-gradient(1200px 700px at 20% -10%, #0f1b2a 0%, #0b0f14 50%); border:1px solid #1e2a3a; border-radius:14px }
.stat { color:var(--muted); font-variant-numeric: tabular-nums }
.footer { color:var(--muted); font-size:12px; margin-top:10px }
@media (max-width: 920px){ main { grid-template-columns: 1fr; } canvas#canvas { height: 58vh } }

/* Proportion bar + sparkline */
.mixwrap { margin-top:10px }
.mixlabel { display:flex; justify-content:space-between; color:var(--muted); font-size:12px; margin-bottom:6px }
.mixbar { height:16px; border-radius:999px; overflow:hidden; border:1px solid #223048; background:#0d1420; display:flex; width:100%; }
.mixbar .seg { height:100%; transition:width 120ms linear }

.sparkwrap { margin-top:10px }
#sparkline { width:100%; height:80px; border-radius:10px; border:1px solid #223048; background:#0c1420; display:block; }

/* Usability polish */
.controls-grid { display:grid; gap:12px }
.group { padding-top:6px; border-top:1px solid #1b2636 }
.group:first-child { border-top:0; padding-top:0 }
.btnbar { display:grid; grid-template-columns: repeat(3, 1fr); gap:8px }
hr.sep { border:0; border-top:1px solid #1b2636; margin:10px 0 }
details.adv { border:1px solid #1e2a3a; border-radius:10px; padding:8px 10px; background:#0f1622 }
details.adv summary { cursor:pointer; color:#9fb3c8 }
details.adv summary::-webkit-details-marker { display:none }
input[type="number"]::-webkit-outer-spin-button, input[type="number"]::-webkit-inner-spin-button { opacity:.3 }
input[type="range"] { margin-top:2px }

.toast { position: fixed; left: 50%; bottom: 18px; transform: translateX(-50%);background: #0f1622; color: var(--text); border: 1px solid #243043;padding: 10px 14px; border-radius: 12px; box-shadow: 0 6px 24px #0007; z-index: 9999;}
